#include "separate_substitution.h"
#include "ldlt_traits.h"
#include "ldlt_substitution_kernel.h"

namespace hplinalg
{

using SubstBlocks    = DefaultBlocks;
using SubstIndexSets = DefaultIndexSets;
using SubstReorder   = DefaultReordering;
using SubstValuePtr  = DefaultValuePtr;

// 求解端的 traits 直接复用 factorization_traits
template <typename B, typename I, typename R, typename V>
using substitution_traits = factorization_traits<B, I, R, V>;

void forward_solve(MatrixRef<MatrixXd> X,
                   const FactorizationData& factorizationData,
                   const ReorderingData&   reorderingData,
                   const double*           vals)
{
    using Traits = substitution_traits<
        SubstBlocks,
        SubstIndexSets,
        SubstReorder,
        SubstValuePtr>;

    detail::SubstitutionKernelLDLT<Traits>::forward(
        X, factorizationData, reorderingData, vals);
}

void backward_solve(MatrixRef<MatrixXd> X,
                    const FactorizationData& factorizationData,
                    const ReorderingData&   reorderingData,
                    const double*           vals)
{
    using Traits = substitution_traits<
        SubstBlocks,
        SubstIndexSets,
        SubstReorder,
        SubstValuePtr>;

    detail::SubstitutionKernelLDLT<Traits>::backward(
        X, factorizationData, reorderingData, vals);
}

} // namespace hplinalg
